{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{player_one}} Vs {{player_two}} | #{{challenge_price}}</title>
    <link rel="icon" href="{% static 'image/logo.png' %}">
    <link rel="stylesheet" href="{% static 'css/gtt_whott.css' %}">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <style>
        body {
      background-color: #1f1f1f;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      padding-top: 80px;
      padding-bottom: 140px;
    }
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: #1f1f1f;
      border-bottom: 1px solid #333;
      z-index: 1000;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .navbar-brand {
      font-size: 1.6rem;
      font-weight: bold;
      color: orange;
      text-shadow: 2px 2px #000;
      display: flex;
      flex-direction: column;
      line-height: 1.2;
    }

    .navbar-brand .slogan {
      font-size: 0.8rem;
      font-weight: 500;
      color: #ffe6b3;
      text-shadow: 1px 1px #000;
      animation: fadeInGlow 3s ease-in-out infinite alternate;
    }

    @keyframes fadeInGlow {
      0% { opacity: 0.4; text-shadow: 0 0 5px orange, 0 0 10px gold, 0 0 15px darkorange; }
      100% { opacity: 1; text-shadow: 0 0 10px orange, 0 0 20px gold, 0 0 30px orangered; }
    }

    .info-card {
      background-color: #1f1f1f;
      border-radius: 15px;
      padding: 10px;
      box-shadow: 0 0 15px rgba(255, 140, 0, 0.2);
      margin-bottom: 30px;
    }

    .text-label {
      font-weight: 0.99rem;
      color: #bbb;
      margin-top: 8px;
    }

    .text-value {
      font-size: 1rem;
      font-weight: bold;
      color: #fff;
    }

    .gold-icon {
      animation: spin 3s linear infinite;
      font-size: 1rem;
      color: gold;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }


    .game-tips {
      background-color: #1f1f1f;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .game-tips h5 {
      color: orange;
      margin-bottom: 10px;
    }

    .game-tips ul {
      padding-left: 18px;
    }

    .game-tips li {
      margin-bottom: 8px;
      color: #ddd;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #1f1f1f;
      border-top: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 30px;
      z-index: 999;
    }

    .bottom-nav .player {
      text-align: center;
      flex: 1;
    }

    .bottom-nav .player span {
      display: block;
      color: #bbb;
      font-size: 0.85rem;
    }

    .bottom-nav .player strong {
      color: orange;
    }




        .auth{
                background-color: #2c90c6;
                border: 1px solid #2c90c6;
                border-radius: 15px;
                -moz-border-radius: 15px;
                -webkit-border-radius: 15px;
                -ms-border-radius: 15px;
                -o-border-radius: 15px;
                color: #fff;
                font-weight: bold;
                line-height: 20px;
                text-align: center;
                text-transform: uppercase;
                width: auto;
            }
            #auth:hover{
                background-color: #2c70c6;
                box-shadow: 2px 2px 20px  #2c90c6, #fff 0 -1px 2px;
            }

    .black-btn {
      background-color: black;
      color: white;
      border: 1px solid white;
      border-radius:20px;
      padding: 5px 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 10px #ccc;
      transition: all 0.3s ease;
    }

    .black-btn:hover {
      color: white;
      border-color: #ccc;
      box-shadow: 0 0 10px #ccc;
    }

    .winner-text {
      font-size: 32px;
      font-weight: 800;
      color: gold;
      background: linear-gradient(to right, #000, #222);
      padding: 20px;
      border: 2px solid gold;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 0 20px gold;
      max-width: 400px;
      margin: 50px auto;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 20px gold; }
      50% { box-shadow: 0 0 40px gold; }
      100% { box-shadow: 0 0 20px gold; }
    }

    .loss-text {
      font-size: 30px;
      font-weight: bold;
      color: #ff4c4c;
      background-color: #1a1a1a;
      padding: 20px;
      border: 2px solid #ff4c4c;
      border-radius: 10px;
      text-align: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      box-shadow: 0 0 15px #ff4c4c;
      max-width: 400px;
      margin: 50px auto;
      animation: shake 0.5s infinite alternate;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    </style>
</head>


<body>

    <!-- Header -->
<div class="navbar">
  <div class="navbar-brand">
    GoldenTwelve
    <small class="slogan">Let's play gold...</small>
  </div>
  <div>
    <i class="fas fa-gamepad fa-xl text-warning"></i>
  </div>
</div>

<div class="game-section">


  <main class="text-center text-white">
    {% csrf_token %}

    <div class="text-center">

        <div id="opponent_space">
            {% if opponent_gender == "Male" %}
                <img src="{% static 'image/man.png' %}" style="width:25px;height:25px;border-radius:100%">
            {% else %}
                <img src="{% static 'image/woman.png' %}" style="width:25px;height:25px;border-radius:100%">
            {% endif %}
            {% if not counted_cards %}
                {% if opp_number_of_cards > 2 %}
                    <p class="text text-center text-warning" style="font:0.99rem italic;">@{{opponent}} <b class="text-secondary">Remaining Cards <i class="text text-warning" id="opp_number_of_card_one">'{{opp_number_of_cards}}'</i></b></p>
                {% elif opp_number_of_cards == 1 %}
                    <p class="text text-center text-warning" style="font:0.99rem italic;">@{{opponent}} <b class="text-secondary">Remaining Cards <i class="text text-danger">'Last Card'</i></b></p>
                {% else %}
                    <p class="text text-center text-warning" style="font:0.99rem italic;">@{{opponent}} <b class="text-secondary">Remaining Cards <i class="text text-danger" id="opp_number_of_card_two">'{{opp_number_of_cards}}'</i></b></p>
                {% endif %}
            {% else %}
                <div class="table-responsive">
                    <table class="table">
                        {% if player_one == user.username %}
                            <tr>
                                {% for i in player_two_cards reversed %}
                                    <th style="border:2px solid black" class="table-head">
                                        {% if i.card_image %}
                                            <button class="card-button" title="{{i.card_number}}..{{i.card_shape}}"><img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px"></button><br><p class="text-secondary" style="font-size:10px">{{i.card_number}}..{{i.card_shape}}</p>
                                        {% endif %}
                                    </th>
                                {% endfor %}
                            </tr>
                        {% else %}
                            <tr>
                                {% for i in player_one_cards reversed %}
                                    <th style="border:2px solid black" class="table-head">
                                        {% if i.card_image %}
                                            <button class="card-button" title="{{i.card_number}}..{{i.card_shape}}"><img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px"></button><br><p class="text-secondary" style="font-size:10px">{{i.card_number}}..{{i.card_shape}}</p>
                                        {% endif %}
                                    </th>
                                {% endfor %}
                            </tr>
                        {% endif %}
                    </table>
                </div>
                {% if opp_number_of_cards > 2 %}
                    <p class="text-center text-warning" style="font:0.99rem italic;">@{{opponent}} <b class="text-secondary">Remaining Cards <i class="text-warning">'{{opp_number_of_cards}}'</i></b></p>
                {% elif opp_number_of_cards == 1 %}
                    <p class="text-center text-warning" style="font:0.99rem italic;">@{{opponent}} <b class="text-secondary">Remaining Cards <i class="text-danger">'Last Card'</i></b></p>
                {% else %}
                    <p class="text-center text-warning" style="font:0.99rem italic;">@{{opponent}} <b class="text-secondary">Remaining Cards <i class="text-danger">'{{opp_number_of_cards}}'</i></b></p>
                {% endif %}
            {% endif %}
        </div>



        <div id="game_space" class="bg-light p-3">
            {% if not game_finished %}
                {% if not counted_cards %}
                    {% if not player_won %}
                        {% if not has_tie %}
                            <div class="row">
                                    <div class="col-4">
                                        <p class="text text-dark" style="font:0.99rem;">General Market</p>
                                        {% if to_play == user.username %}
                                            <button class="card-button general-market" style="border:0px solid white" onclick="generalMarket()"><img src="{% static 'image/gtt_whot_logo.png' %}" class="general-market" style="width:100px;height:100px;border-radius:20px;"></button>
                                        {% else %}
                                            <button class="card-button" style="border:0px solid white"><img src="{% static 'image/gtt_whot_logo.png' %}" class="general-market" style="width:100px;height:100px;border-radius:20px;"></button>
                                        {% endif %}
                                        <p class="text text-dark"  style="text-shadow:none" id="number_of_general_market">{{number_of_general_market}}</p>
                                    </div>
                                    <div class="col-4">
                                        <p class="text text-dark" style="font:0.99rem;">Current</p>
                                        {% for i in current_card %}
                                            <div id="current_card_space">
                                                <img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px">
                                                <p class="text text-dark" style="font-size:15px">{{i.card_number}}..{{i.card_shape}}</p>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <div class="col-4 info-card">
                                        <div class="info-item">
                                            <div class="text-label" style="font:0.99rem;">Stake</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_amount}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                            <div class="text-label mt-3" style="font:0.99rem;">Winning Potential</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_price}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                        </div>
                                    </div>
                            </div>
                        {% else %}
                            {% if player_one == user.username %}
                                <div class="row">
                                    <div class="col-4">
                                        <p class="text-center text-danger text" style="font-size:25px">Market Finished!</p>
                                        <a class="btn btn-outline-warning auth" id="count_card" onclick="countCards()" style="text-shadow:none">click here to Count Cards!</a>
                                        <div id="count_card_spinner" style="display:none">
                                            <div class="d-flex justify-content-center">
                                                <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                    <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                    counting Cards...
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <p class="text text-dark" style="font:0.99rem;">Current</p>
                                        {% for i in current_card %}
                                            <img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px">
                                            <p class="text text-dark" style="font-size:15px">{{i.card_number}}..{{i.card_shape}}</p>
                                        {% endfor %}
                                    </div>
                                    <div class="col-4 info-card">
                                        <div class="info-item">
                                            <div class="text-label" style="font:0.99rem;">Stake</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_amount}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                            <div class="text-label mt-3" style="font:0.99rem;">Winning Potential</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_price}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <div class="row">
                                    <div class="col-4">
                                        <p class="text-center text-danger text" style="font-size:25px;">Market Finished!</p>
                                        <a class="btn btn-outline-warning auth" id="count_card" onclick="countCards()" style="text-shadow:none">click here to Count Cards!</a>
                                        <div id="count_card_spinner" style="display:none">
                                            <div class="d-flex justify-content-center">
                                                <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                    <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                    counting Cards...
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <p class="text text-dark" style="font:0.99rem;">Current</p>
                                        {% for i in current_card %}
                                            <img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px;">
                                            <p class="text text-dark" style="font-size:15px">{{i.card_number}}..{{i.card_shape}}</p>
                                        {% endfor %}
                                    </div>
                                    <div class="col-4 info-card">
                                        <div class="info-item">
                                            <div class="text-label" style="font:0.99rem;">Stake</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_amount}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                            <div class="text-label mt-3" style="font:0.99rem;">Winning Potential</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_price}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                    {% else %}
                        {% if player_one == user.username %}
                                <div class="row">
                                    <div class="col-4">
                                        <p class="text-center text-primary text" style="font:0.99rem;">Check Up!</p>
                                        <a class="btn btn-outline-warning auth" id="count_card" onclick="countCards()" style="text-shadow:none">Count Cards</a>
                                        <div id="count_card_spinner" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                Loading...
                                            </button>
                                        </div>
                                    </div>
                                    </div>
                                    <div class="col-4">
                                        <p class="text text-dark" style="font:0.99rem;">Current</p>
                                        {% for i in current_card %}
                                            <img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px">
                                            <p class="text text-dark" style="font:0.99rem;">{{i.card_number}}..{{i.card_shape}}</p>
                                        {% endfor %}
                                    </div>
                                    <div class="col-4 info-card">
                                        <div class="info-item">
                                            <div class="text-label" style="font:0.99rem;">Stake</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_amount}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                            <div class="text-label mt-3" style="font:0.99rem;">Winning Potential</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_price}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                        </div>
                                    </div>
                                </div>
                        {% else %}
                                <div class="row">
                                    <div class="col-4">
                                        <p class="text-center text-primary text" style="font-size:25px;">Check Up!</p>
                                        <a class="btn btn-outline-warning auth" id="count_card" onclick="countCards()" style="text-shadow:none">Count Cards</a>
                                        <div id="count_card_spinner" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                Loading...
                                            </button>
                                        </div>
                                    </div>
                                    </div>
                                    <div class="col-4">
                                        <p class="text text-dark" style="font:0.99rem;">Current</p>
                                        {% for i in current_card %}
                                            <img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px">
                                            <p class="text text-dark" style="font:0.99rem;">{{i.card_number}}..{{i.card_shape}}</p>
                                        {% endfor %}
                                    </div>
                                    <div class="col-4 info-card">
                                        <div class="info-item">
                                            <div class="text-label" style="font:0.99rem;">Stake</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_amount}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                            <div class="text-label mt-3" style="font:0.99rem;">Winning Potential</div>
                                            <div class="text-value" style="font:0.99rem;">₦{{challenge_price}} <i class="fas fa-coins gold-icon mx-1"></i></div>
                                        </div>
                                    </div>
                                </div>
                        {% endif %}
                    {% endif %}
                {% else %}
                    {% if player_one == user.username %}
                            <div>
                                {% if player_one_card_amount <  player_two_card_amount %}
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_one}}' Total Cards Amount::<i class="text text-success">{{player_one_card_amount}}</i></h1>
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_two}}' Total Cards Amount::<i class="text text-danger">{{player_two_card_amount}}</i></h1>
                                    <a class="btn btn-outline-warning auth" id="end_game" style="text-shadow:none" onclick="endGame()">End Game</a>
                                    <div id="end_game_spinner" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                Loading...
                                            </button>
                                        </div>
                                    </div>
                                {% elif player_one_card_amount >  player_two_card_amount %}
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_one}}' Total Cards Amount::<i class="text text-danger">{{player_one_card_amount}}</i></h1>
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_two}}' Total Cards Amount::<i class="text text-success">{{player_two_card_amount}}</i></h1>
                                    <a class="btn btn-outline-warning auth" style="text-shadow:none" id="end_game" onclick="endGame()">End Game</a>
                                    <div id="end_game_spinner" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                Loading...
                                            </button>
                                        </div>
                                    </div>
                                {% else %}
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_one}}' Total Cards Amount::<i class="text text-secondary">{{player_one_card_amount}}</i></h1>
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_two}}' Total Cards Amount::<i class="text text-secondary">{{player_two_card_amount}}</i></h1>
                                    <a class="btn btn-outline-warning auth" id="end_game" style="text-shadow:none" onclick="endGame()">End Tie Game</a>
                                    <div id="end_game_spinner" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                Loading...
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                    {% else %}
                            <div>
                                {% if player_one_card_amount <  player_two_card_amount %}
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_one}}' Total Cards Amount::<i class="text text-success">{{player_one_card_amount}}</i></h1>
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_two}}' Total Cards Amount::<i class="text text-danger">{{player_two_card_amount}}</i></h1>
                                    <a class="btn btn-outline-warning auth" id="end_game" style="text-shadow:none" onclick="endGame()">End Game</a>
                                    <div id="end_game_spinner" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                Loading...
                                            </button>
                                        </div>
                                    </div>
                                {% elif player_one_card_amount >  player_two_card_amount %}
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_one}}' Total Cards Amount::<i class="text text-danger">{{player_one_card_amount}}</i></h1>
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_two}}' Total Cards Amount::<i class="text text-success">{{player_two_card_amount}}</i></h1>
                                    <a class="btn btn-outline-warning auth" id="end_game" style="text-shadow:none" onclick="endGame()">End Game</a>
                                    <div id="end_game_spinner" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                Loading...
                                            </button>
                                        </div>
                                    </div>
                                {% else %}
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_one}}' Total Cards Amount::<i class="text text-secondary">{{player_one_card_amount}}</i></h1>
                                    <h1 class="text text-center text-dark" style="font-size:20px">'{{player_two}}' Total Cards Amount::<i class="text text-secondary">{{player_two_card_amount}}</i></h1>
                                    <a class="btn btn-outline-warning auth" id="end_game" style="text-shadow:none" onclick="endGame()">End Game</a>
                                    <div id="end_game_spinner" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <button class="btn text-center btn-outline-warning auth" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm make-deposit" role="status" aria-hidden="true"></span>
                                                Loading...
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
            {% endif %}
                {% endif %}
            {% else %}
                {% if game_winner != "Draw" %}
                    {% if game_winner == user.username %}
                        <p class="text-center winner-text my-5" style="font:0.99rem;color:rgba(0,255,0,0.5)">You Win ₦{{challenge_price}} <i class="fas fa-coins gold-icon mx-1"></i></p><br>
                        <img src="{% static 'image/WIN_GIF.gif' %}" class="img-fluid rounded-circle my-3" style="width:150px;height:150px"><br>
                        {% csrf_token %}
                        <a class="btn btn-outline-warning auth" style="text-shadow:none" onclick="finishGame()">Finish </a>
                    {% else %}
                        <h1 class="text-center loss-text my-5" style="font:0.99rem;">You Loss </h1>
                        <img src="{% static 'image/LOSS_GIF.gif' %}" class="img-fluid rounded-circle my-3" style="width:150px;height:150px"><br>
                        {% csrf_token %}
                        <a class="btn btn-outline-warning auth" style="text-shadow:none" onclick="finishGame()">Finish</a>
                    {% endif %}
                {% else %}
                    <h1 class="text-center text text-secondary my-5">Tie Game</h1><br>
                    <img src="{% static 'image/BREAK_EVEN_GIF.gif' %}" class="img-fluid rounded-circle my-3" style="width:150px;height:150px"><br>
                    {% csrf_token %}
                    <a class="btn btn-outline-warning auth" style="text-shadow:none" onclick="finishGame()">Finish </a>
                {% endif %}
            {% endif %}

        </div>

        <hr>

        <div id="user_space">
            {% if number_of_general_market >= 1%}
                {% if not hold_on %}
                    {% if not required_to_pick %}
                        <div id="not_required_to_pick">
                            {% if to_play == user.username %}
                                <b class="text text-center text-secondary" style="font:0.99rem;">Your Turn...</b>
                            {% else %}
                                <b class="text text-center text-secondary" style="font:0.99rem;">waiting for {{opponent}}...</b>
                            {% endif %}
                        </div>
                    {% else %}
                        <div id="required_to_pick">
                            {% if to_play == user.username %}
                                <b class="text-center text-warning" style="font:0.99rem;">Your Turn,Please Pick {{no_of_cards_to_pick}}</b>
                            {% else %}
                                <b class="text-center text-warning" style="font:0.99rem;">waiting for {{opponent}} to pick {{no_of_cards_to_pick}}...</b>
                            {% endif %}
                        </div>
                    {% endif %}
                {% else %}
                    <div id="hold_on">
                        {% if to_play == user.username %}
                            <b class="text-center text-warning" style="font:0.99rem;">Your Turn,Please Continue...</b>
                        {% else %}
                            <b class="text-center text-warning" style="font:0.99rem;">Hold On, waiting for '{{opponent}}' to Continue...</b>
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                {% if to_play == user.username %}
                    <b class="text-center text-warning" style="font:0.99rem;">General Market Finished Please </b><button class="black-btn" onclick="generalMarket()">click here</button>
                {% else %}
                    <b class="text-center text-warning" style="font:0.99rem;">General Market Finished Please </b><button class="black-btn" onclick="generalMarket()">click here</button>
                {% endif %}
            {% endif %}
            <br>
            <hr>
            <b class="text-center text-secondary" style="font:0.99rem;"><i class="text-warning">Your</i> Remaining Cards <i class="text-warning">'{{number_of_cards}}'</i></b>
            <br>


            <div class="table-responsive">
                <table class="table">
                    {% if player_one == user.username %}
                        {% if can_play %}
                            {% if to_play == user.username %}
                                {% if player_one == user.username %}
                                    <tr id="player_one_cards_func">
                                        {% for i in player_one_cards reversed %}
                                            <th style="border:2px solid black;cursor:pointer" class="table-head" onclick="submitCard({{i.id}},'{{i.card_shape}}',{{i.card_number}},'player_one')" >
                                                {% if i.card_image %}
                                                    <button type="submit" class="card-button player-one-cards" title="{{i.card_number}}..{{i.card_shape}}" onclick="submitCard({{i.id}},'{{i.card_shape}}',{{i.card_number}},'player_one')"><img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px"></button><br><p class="text-secondary" style="font-size:10px">{{i.card_number}}..{{i.card_shape}}</p>
                                                {% endif %}
                                            </th>
                                        {% endfor %}
                                    </tr>
                                {% endif %}
                            {% else %}
                                {% if player_one == user.username %}
                                    <tr>
                                        {% for i in player_one_cards reversed %}
                                            <th id="player_one_cards" style="border:2px solid black" class="table-head">
                                                {% if i.card_image %}
                                                    <button  class="card-button" title="{{i.card_number}}..{{i.card_shape}}"><img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px"></button><br><p class="text-secondary" style="font-size:10px">{{i.card_number}}..{{i.card_shape}}</p>
                                                {% endif %}
                                            </th>
                                        {% endfor %}
                                    </tr>
                                {% endif %}
                            {% endif %}
                        {% else %}
                            <tr>
                                {% for i in player_one_cards reversed %}
                                    <th style="border:2px solid black" class="table-head">
                                        {% if i.card_image %}
                                            <button  class="card-button" title="{{i.card_number}}..{{i.card_shape}}"><img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px"></button><br><p class="text-secondary" style="font-size:10px">{{i.card_number}}..{{i.card_shape}}</p>
                                        {% endif %}
                                    </th>
                                {% endfor %}
                            </tr>
                        {% endif %}
                    {% endif %}
<!--                End Player One-->

<!--                    Player Two Cards-->
                    {% if player_two == user.username %}
                        {% if can_play %}
                            {% if to_play == user.username %}
                                {% if player_two == user.username %}
                                    <tr>
                                        {% for i in player_two_cards reversed %}
                                        <th id="player_two_cards_func" style="border:2px solid black;cursor:pointer" class="table-head" onclick="submitCard({{i.id}},'{{i.card_shape}}',{{i.card_number}},'player_one')">
                                            {% if i.card_image %}
                                                <button class="card-button player-two-cards" title="{{i.card_number}}..{{i.card_shape}}" onclick="submitCard({{i.id}},'{{i.card_shape}}',{{i.card_number}},'player_two')"><img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px"></button><br><p class="text-secondary" style="font-size:10px">{{i.card_number}}..{{i.card_shape}}</p>
                                            {% endif %}
                                        </th>
                                        {% endfor %}
                                    </tr>
                                {% endif %}
                            {% else %}
                                {% if player_two == user.username %}
                                    <tr>
                                        {% for i in player_two_cards reversed %}
                                        <th id="player_two_cards" style="border:2px solid black" class="table-head">
                                            {% if i.card_image %}
                                                <button class="card-button" title="{{i.card_number}}..{{i.card_shape}}"><img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px"></button><br><p class="text-secondary" style="font-size:10px">{{i.card_number}}..{{i.card_shape}}</p>
                                            {% endif %}
                                        </th>
                                        {% endfor %}
                                    </tr>
                                {% endif %}
                            {% endif %}
                        {% else %}
                            <tr>
                                {% for i in player_two_cards reversed %}
                                    <th style="border:2px solid black" class="table-head">
                                        {% if i.card_image %}
                                            <button class="card-button" title="{{i.card_number}}..{{i.card_shape}}"><img src="{{i.card_image.url}}" style="width:100px;height:100px;border-radius:20px"></button><br><p class="text-secondary" style="font-size:10px">{{i.card_number}}..{{i.card_shape}}</p>
                                        {% endif %}
                                    </th>
                                {% endfor %}
                            </tr>
                        {% endif %}
                    {% endif %}
                </table>
            </div>
        </div>


        {% if not game_finished %}
            {% if not counted_cards %}
                {% if not player_won %}
                    {% if not has_tie %}
                        {% if is_special %}
                            <form class="mt-5" action="/gttWhott/gttWhot/specialService" method="post" enctype="multipart/form-data" onsubmit="specialMember()">
                            {% csrf_token %}
                            <!--        Special Service For Member-->
                            <div class="row">
                <!--                General Market-->
                                <div class="col-md-4">
                                    <label>General Market</label>
                                    <select  class="form-control text-center gtt-four-man-select" name="special_general_market" id="special_general_market" required>
                                        <option value="select-option">Select Card</option>
                                        {% for i in general_market %}
                                            <option value="{{i.id}}">{{i.card_number}}...{{i.card_shape}}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                {% if user.username == player_one %}
                                    <div class="col-md-4 my-1">
                                        <label>Your Cards</label>
                                        <select  class="form-control text-center gtt-four-man-select" name="special_player_card" id="special_player_one" required>
                                             <option value="select-option">Select Card</option>
                                            {% for i in player_one_cards reversed %}
                                                <option value="{{i.id}}">{{i.card_number}}...{{i.card_shape}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                {% elif user.username == player_two %}
                                    <div class="col-md-4 my-1">
                                        <label>Your Cards</label>
                                        <select  class="form-control text-center gtt-four-man-select" name="special_player_card" id="special_player_two" required>
                                             <option value="select-option">Select Card</option>
                                          {% for i in player_two_cards reversed %}
                                                <option value="{{i.id}}">{{i.card_number}}...{{i.card_shape}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                {% endif %}
                                    <div class="col-md-4 my-1" id="start_game">
                                        <input type="submit" class="btn btn-outline-warning  auth" value="exchange">
                                    </div>
                                    <div class="col-md-4 my-1" id="game_spinner" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <button class="btn text-center btn-outline-warning shuffle-cards-spinner  auth" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm shuffle-cards-spinner " role="status" aria-hidden="true"></span>
                                                Exchanging Cards...
                                            </button>
                                        </div>
                                    </div>
                            </div>
                        </form>
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}
        {% endif %}

        <!-- Tips -->
      <div class="game-tips my-5">
        <h5>How to Play</h5>
        <ul style="list-style-type:none">
          <li>Match either <strong>number</strong> or <strong>shape</strong> of last played card</li>
          <li>First player to finish all cards wins</li>
          <li><strong>1</strong> - Hold On</li>
          <li><strong>2</strong> - Pick Two</li>
          <li><strong>5</strong> - Pick Three</li>
          <li><strong>14</strong> - General Market</li>
        </ul>
      </div>
    </div>
  </main>


  <!-- Footer: Player vs Opponent -->
<div class="bottom-nav">
  <div class="player">
    <span>{{player_one}}</span>
    <strong>Player One</strong>
  </div>
  <div class="player">
    <span>Game Timer</span>
    <strong>00:<b id="gameTimer">30</b></strong>
  </div>
  <div class="player">
    <span>{{player_two}}</span>
    <strong>Player Two</strong>
  </div>
</div>
</div>

<!--    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.slim.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/gttwhott.js' %}"></script>
    <script>


        function specialMember(){
            var getStartGame = document.getElementById("start_game");
            getStartGame.style.display = "none";
            var getGameSpinner = document.getElementById("game_spinner");
            getGameSpinner.style.display = "inline";

        }

        function reloadPage(){
            location.reload()

        }




        <!--  SSE CONNECTION-->
  const sse = new EventSource("/events/");
  sse.onmessage = function(event){
    try{
      const data = JSON.parse(event.data);
      if(data.type == "first_n"){
        console.log(data.username);
        console.log(data.balance);
      }else if(data.type == "check_member_whot_game_timer"){
        const getTimer = document.getElementById("gameTimer");
        getTimer.textContent = data.game_timer;
        if(data.game_timer === 0 && data.reload){
            generalMarket();
        }
      }
      else if(data.type == "check_allow_game_reload"){
        console.log(data.allow_reload);
        console.log('data.allow_reload');
      }
      else if(data.type == "check_member_game_reload"){
         console.log("check_member_game_reload");
         $.ajax({
            type:"GET",
            url:"/gttWhott/gttWhot/update/gameReload",
            success:function(data){
                console.log("reload called");
                reloadPage();
            },
            error:function(){
                location.reload(true);
            }
         });
      }
    }
    catch(err){
      console.log("Failed to parse message");
      location.reload();
    }
  };


  sse.onerror = function(e){
    console.log("SSE CONNECTION ERROR",e)
  };
    </script>

</body>
</html>